<view class="page">
  <view class="form">
    <view class="group">
      <view class="label">商品名称 <text class="req">*</text></view>
      <input class="input" placeholder="请输入商品名称" value="{{form.name}}" data-field="name" bindinput="onInput" />
    </view>
    <view class="group">
      <view class="label">SKU 编码 <text class="req" wx:if="{{!isEdit}}">*</text></view>
      <input
        class="input"
        placeholder="请输入 SKU"
        value="{{form.sku_code}}"
        data-field="sku_code"
        bindinput="onInput"
        disabled="{{isEdit}}"
      />
    </view>
    <view class="group">
      <view class="label">规格备注</view>
      <input class="input" placeholder="可选，如 500g/袋" value="{{form.spec}}" data-field="spec" bindinput="onInput" />
    </view>
    <view class="group">
      <view class="label">分类</view>
      <picker mode="selector" range="{{categories}}" range-key="name" value="{{categoryIndex}}" bindchange="onCategoryPick">
        <view class="picker-value">{{categoryName || '请选择分类'}}</view>
      </picker>
    </view>
    <view class="group">
      <view class="label">商品图片</view>
      <view class="image-upload">
        <view class="image-preview" wx:if="{{form.cover_image}}">
          <image src="{{form.cover_image}}" mode="aspectFill" class="preview-img" />
          <view class="del-btn" bindtap="onDelImage">×</view>
        </view>
        <view class="upload-btn" wx:else bindtap="onChooseImage">
          <text class="upload-icon">+</text>
          <text class="upload-text">上传图片</text>
        </view>
      </view>
    </view>
    <view class="group">
      <view class="label">品牌</view>
      <input class="input" placeholder="请输入品牌" value="{{form.brand}}" data-field="brand" bindinput="onInput" />
    </view>
    <view class="group">
      <view class="label">单位</view>
      <picker mode="selector" range="{{units}}" value="{{unitIndex}}" bindchange="onUnitPick">
        <view class="picker-value">{{form.unit || '件'}}</view>
      </picker>
    </view>
    <view class="group">
      <view class="label">进价</view>
      <input class="input" type="digit" placeholder="0.00" value="{{form.purchase_price}}" data-field="purchase_price" bindinput="onInput" />
    </view>
    <view class="group">
      <view class="label">售价</view>
      <input class="input" type="digit" placeholder="0.00" value="{{form.sale_price}}" data-field="sale_price" bindinput="onInput" />
    </view>
    <view class="group section-title">尺码与库存（每码单独库存）</view>
    <view class="sku-list" wx:for="{{skus}}" wx:key="id">
      <view class="sku-row">
        <input class="input sku-size" placeholder="鞋码" value="{{item.size}}" data-index="{{index}}" data-field="size" bindinput="onSkuInput" disabled="{{isEdit && item.id}}" />
        <input class="input sku-num" type="number" placeholder="库存" value="{{item.stock}}" data-index="{{index}}" data-field="stock" bindinput="onSkuInput" />
        <input class="input sku-num" type="number" placeholder="最低" value="{{item.min_stock}}" data-index="{{index}}" data-field="min_stock" bindinput="onSkuInput" />
        <input class="input sku-num" type="number" placeholder="最高" value="{{item.max_stock}}" data-index="{{index}}" data-field="max_stock" bindinput="onSkuInput" />
        <view class="sku-actions" wx:if="{{isEdit && item.id && item.id > 0}}">
          <text class="link" bindtap="onSaveSku" data-index="{{index}}">保存</text>
          <text class="link danger" wx:if="{{skus.length > 1}}" bindtap="onDelSku" data-index="{{index}}">删</text>
        </view>
        <view class="sku-actions" wx:elif="{{isEdit && !item.id}}">
          <text class="link" bindtap="onSaveNewSku" data-index="{{index}}">添加</text>
        </view>
        <view class="sku-actions" wx:elif="{{!isEdit}}">
          <text class="link danger" wx:if="{{skus.length > 1}}" bindtap="onDelSku" data-index="{{index}}">删</text>
        </view>
      </view>
    </view>
    <view class="group">
      <button class="btn-add-sku" bindtap="onAddSku">+ 添加尺码</button>
    </view>
  </view>

  <view class="actions">
    <button class="btn btn-cancel" bindtap="onCancel">取消</button>
    <button class="btn btn-submit" loading="{{submitting}}" disabled="{{submitting}}" bindtap="onSubmit">
      {{submitText}}
    </button>
  </view>
</view>
